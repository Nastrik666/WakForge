(function(){"use strict";importScripts("https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js");let t=null,a=null,o=null,r=null,d=null,i=null;const c=async()=>{a=await loadPyodide(),await a.loadPackage("micropip");const e=a.pyimport("micropip");console.log("Installing msgspec"),await e.install("https://cdn.jsdelivr.net/gh/mikeshardmind/wakfu-utils@d4d24e1f631b5cf99ee1d9a7ee18bb8bd954fe9c/msgspec-0.18.4-cp311-cp311-emscripten_3_1_45_wasm32.whl"),console.log("Setting up the AutoBuild package loaded."),await e.install("wakautosolver"),console.log("AutoBuild package installed."),o=a.pyimport("wakautosolver.versioned_entrypoints"),console.log("AutoBuild package loaded."),postMessage("workerReady")},u=async()=>{var e;await g(r),(e=t==null?void 0:t[0])!=null&&e.length?p():(console.log("We had no calculation results, which means an error occured",t[1]),postMessage(t[1]))},g=async e=>{console.log("Python Params (useful for debugging if you need them)",e);let l=o.Stats.callKwargs(e.currentStatParams),s=o.SetMinimums.callKwargs(e.targetStatParams),n={lv:e.targetLevel,stats:l,target_stats:s,equipped_items:e.currentItemIds,num_mastery:e.targetNumElements,allowed_rarities:e.selectedRarityIds!==void 0?e.selectedRarityIds:[0,1,2,3,4,5,6,7],dist:e.distanceMastery,melee:e.meleeMastery,heal:e.healingMastery,zerk:e.berserkMastery,rear:e.rearMastery,dry_run:!1};console.log("Calling the Python solver method now.");let y=o.partial_solve_v1.callKwargs(n);console.log("Assigning results."),t=y},p=()=>{console.log("Collecting the item data for the FE display.");let e=t[0],l=[];d.forEach(s=>{e.includes(s.id)&&l.push(s)}),l.sort((s,n)=>i.indexOf(s.type.validSlots[0])-i.indexOf(n.type.validSlots[0])),console.log("Item data is",l),postMessage({items:l})};c(),onmessage=async e=>{r=e.data.params,d=e.data.itemData,i=e.data.ITEM_SLOT_SORT_ORDER,u()}})();
