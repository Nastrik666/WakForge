(function(){"use strict";importScripts("https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js");let a=null,l=null,s=null,o=null,i=null,c=null;const u=async()=>{l=await loadPyodide(),await l.loadPackage("micropip");const e=l.pyimport("micropip");console.log("Installing msgspec"),await e.install("https://cdn.jsdelivr.net/gh/mikeshardmind/wakfu-utils@d4d24e1f631b5cf99ee1d9a7ee18bb8bd954fe9c/msgspec-0.18.4-cp311-cp311-emscripten_3_1_45_wasm32.whl"),console.log("Setting up the AutoBuild package loaded."),await e.install("wakautosolver"),console.log("AutoBuild package installed."),s=l.pyimport("wakautosolver.versioned_entrypoints"),console.log("AutoBuild package loaded."),postMessage("workerReady")},d=async()=>{var e;await g(o),(e=a==null?void 0:a[0])!=null&&e.length?h():postMessage(a[1])},g=async e=>{let t={},r=null;e.currentCharacter&&(t={ap:e.currentCharacter.actionPoints,mp:e.currentCharacter.movementPoints,wp:e.currentCharacter.wakfuPoints,ra:e.currentCharacter.stats.range,crit:e.currentCharacter.stats.criticalHit,crit_mastery:e.currentCharacter.masteries.critical,elemental_mastery:null,one_element_mastery:null,two_element_mastery:null,three_element_mastery:null,distance_mastery:e.currentCharacter.masteries.distance,rear_mastery:e.currentCharacter.masteries.rear,heal_mastery:e.currentCharacter.masteries.healing,beserk_mastery:e.currentCharacter.masteries.berserk,melee_mastery:e.currentCharacter.masteries.melee,control:e.currentCharacter.stats.control,block:e.currentCharacter.stats.block,heals_performed:e.currentCharacter.stats.healsPerformed,lock:e.currentCharacter.stats.lock,dodge:e.currentCharacter.stats.dodge}),r=s.Stats.callKwargs(t);let n={ap:e.targetStats.actionPoints,mp:e.targetStats.movementPoints,ra:e.targetStats.range,wp:e.targetStats.wakfuPoints},y=s.SetMinimums.callKwargs(n),m={lv:e.targetLevel,stats:r,target_stats:y,equipped_items:e.currentItemIds,num_mastery:e.targetNumElements,allowed_rarities:e.selectedRarityIds!==void 0?e.selectedRarityIds:[0,1,2,3,4,5,6,7],dist:e.distanceMastery,melee:e.meleeMastery,heal:e.healingMastery,zerk:e.berserkMastery,rear:e.rearMastery,dry_run:!1};console.log("Python Params (useful for debugging if you need them)",e),console.log("Current Stats",t),console.log("Target Stats From Items",n),a=s.partial_solve_v1.callKwargs(m)},h=()=>{let e=a[0],t=[];i.forEach(r=>{e.includes(r.id)&&t.push(r)}),t.sort((r,n)=>c.indexOf(r.type.validSlots[0])-c.indexOf(n.type.validSlots[0])),postMessage({items:t})};u(),onmessage=async e=>{o=e.data.params,i=e.data.itemData,c=e.data.ITEM_SLOT_SORT_ORDER,d()}})();
