(function(){"use strict";importScripts("https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js");let t=null,a=null,i=null,d=null,r=null,o=null;const c=async()=>{a=await loadPyodide(),await a.loadPackage("micropip");const e=a.pyimport("micropip");console.log("Installing msgspec"),await e.install("https://cdn.jsdelivr.net/gh/mikeshardmind/wakfu-utils@d4d24e1f631b5cf99ee1d9a7ee18bb8bd954fe9c/msgspec-0.18.4-cp311-cp311-emscripten_3_1_45_wasm32.whl"),console.log("Setting up the AutoBuild package loaded."),await e.install("wakautosolver"),console.log("AutoBuild package installed."),i=a.pyimport("wakautosolver.versioned_entrypoints"),console.log("AutoBuild package loaded."),postMessage("workerReady")},u=async()=>{var e;await g(d),(e=t==null?void 0:t[0])!=null&&e.length?p():postMessage(t[1])},g=async e=>{console.log("Python Params (useful for debugging if you need them)",e);let s=i.Stats.callKwargs(e.currentStatParams),l=i.SetMinimums.callKwargs(e.targetStatParams),n={lv:e.targetLevel,stats:s,target_stats:l,equipped_items:e.currentItemIds,num_mastery:e.targetNumElements,allowed_rarities:e.selectedRarityIds!==void 0?e.selectedRarityIds:[0,1,2,3,4,5,6,7],dist:e.distanceMastery,melee:e.meleeMastery,heal:e.healingMastery,zerk:e.berserkMastery,rear:e.rearMastery,dry_run:!1};t=i.partial_solve_v1.callKwargs(n)},p=()=>{let e=t[0],s=[];r.forEach(l=>{e.includes(l.id)&&s.push(l)}),s.sort((l,n)=>o.indexOf(l.type.validSlots[0])-o.indexOf(n.type.validSlots[0])),postMessage({items:s})};c(),onmessage=async e=>{d=e.data.params,r=e.data.itemData,o=e.data.ITEM_SLOT_SORT_ORDER,u()}})();
